function PHI = formPHI(states,forces,moments,timestep)

e = 0.0818191910428; % eccentricity
a = 6378137.0; % equatorial radius [meters]
omega_ie = 7.292115e-5; % Earth's rotation rate [rad/s]
m = 1202.7;
Ixx = 4044.7;
Iyy = 1994.9;
Izz = 5639.2;

fb1 = forces(1);
fb2 = forces(2);
fb3 = forces(3);

u = states(1);
v = states(2);
w = states(3);
p = states(4);
q = states(5);
r = states(6);
lat = states(7);
long = states(8);
alt = states(9);
phi = states(10);
theta = states(11);
psi = states(12);

cphi = cos(phi);
sphi = sin(phi);

ctheta = cos(theta);
stheta = sin(theta);
ttheta = tan(theta);

cpsi = cos(psi);
spsi = sin(psi);

slong = sin(long);
clong = cos(long);

F = zeros(14,14);

F(1,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (v*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                                 w/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))) - 2*omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                                    v/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))),                    0,                   0,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    v*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - 2*omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) + (v*w*slong)/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) - (a*e^2*v*w*slong)/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - (u*v*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 - (v*w)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (fb2*( sphi*spsi +  cphi*cpsi*stheta))/m + (fb3*( cphi*spsi - cpsi* sphi*stheta))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (fb3* cphi*cpsi*ctheta)/m - (fb1*cpsi*stheta)/m + (fb2*cpsi*ctheta* sphi)/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (fb3*(cpsi* sphi -  cphi*spsi*stheta))/m - (fb2*( cphi*cpsi +  sphi*spsi*stheta))/m - (fb1*ctheta*spsi)/m];
F(2,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                       2*omega_ie*slong + (w*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (2*u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                                                                                                                                                                            0, 2*omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                    0,                   0,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         - u*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - 2*omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - w*(2*omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (u^2*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 - (u*w*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     - (fb2*(cpsi* sphi -  cphi*spsi*stheta))/m - (fb3*( cphi*cpsi +  sphi*spsi*stheta))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (fb3* cphi*ctheta*spsi)/m - (fb1*spsi*stheta)/m + (fb2*ctheta* sphi*spsi)/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (fb3*( sphi*spsi +  cphi*cpsi*stheta))/m - (fb2*( cphi*spsi - cpsi* sphi*stheta))/m + (fb1*cpsi*ctheta)/m];
F(3,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - v/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))) - (v*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                               - 2*omega_ie*clong - u/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))) - (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                                                                                      0,                    0,                   0,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    v*(2*omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (u*v*slong)/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*u*v*slong)/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (u*v*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (u*v)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (fb2* cphi*ctheta)/m - (fb3*ctheta* sphi)/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       - (fb1*ctheta)/m - (fb3* cphi*stheta)/m - (fb2* sphi*stheta)/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(4,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                            0,                                                                                      0,                    0, (Iyy*r - Izz*r)/Ixx,  (Iyy*q - Izz*q)/Ixx, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(5,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                            0,                                                                                      0, -(Ixx*r - Izz*r)/Iyy,                   0, -(Ixx*p - Izz*p)/Iyy, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(6,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                            0,                                                                                      0,  (Ixx*q - Iyy*q)/Izz, (Ixx*p - Iyy*p)/Izz,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(7,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                                                                                                                                                                            0,                                                                                      0,                    0,                   0,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (3*a*e^2*u*clong*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -u/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(8,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                          1/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))),                                                                                      0,                    0,                   0,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (v*slong)/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) - (a*e^2*v*slong)/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -v/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(9,1:12) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                            0,                                                                                     -1,                    0,                   0,                    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0];
F(10,1:12) = [(slong*stheta)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - cphi*ttheta*((clong*(sphi*spsi + cphi*cpsi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) + (cphi*ctheta*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + sphi*ttheta*((clong*(cphi*spsi - cpsi*sphi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (ctheta*slong*sphi)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (clong*cpsi*ctheta)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)), (ctheta*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))) - (cphi*ttheta*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))) + (sphi*ttheta*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))),                                                                                      0,                    1, sphi*ttheta,  cphi*ttheta, 0, stheta*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) + cpsi*ctheta*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) + cphi*ttheta*((sphi*spsi + cphi*cpsi*stheta)*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - cphi*ctheta*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (v*slong*(cpsi*sphi - cphi*spsi*stheta))/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*v*slong*(cpsi*sphi - cphi*spsi*stheta))/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2))) - sphi*ttheta*((cphi*spsi - cpsi*sphi*stheta)*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) + ctheta*sphi*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (v*slong*(cphi*cpsi + sphi*spsi*stheta))/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*v*slong*(cphi*cpsi + sphi*spsi*stheta))/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2))) + (v*ctheta*slong*spsi)/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) - (a*e^2*v*ctheta*slong*spsi)/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2)), cphi*ttheta*((u*clong*(sphi*spsi + cphi*cpsi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2) + (u*cphi*ctheta*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2) - sphi*ttheta*((u*clong*(cphi*spsi - cpsi*sphi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2) - (u*ctheta*slong*sphi)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2) - (u*slong*stheta)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (u*clong*cpsi*ctheta)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 - (v*ctheta*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2),         cphi*ttheta*(q + (cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - sphi*ttheta*(r - (sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - cphi*ttheta*((cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - sphi*ttheta*((sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))), cphi*(ttheta^2 + 1)*(r - (sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - cphi*ttheta*(cphi*stheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*cpsi*ctheta*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*cphi*ctheta*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) + sphi*(ttheta^2 + 1)*(q + (cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) + cpsi*stheta*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - sphi*ttheta*(sphi*stheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cpsi*ctheta*sphi*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*ctheta*sphi*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - (v*spsi*stheta)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))), sphi*ttheta*((cphi*cpsi + sphi*spsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cphi*spsi - cpsi*sphi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - cphi*ttheta*((cpsi*sphi - cphi*spsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(sphi*spsi + cphi*cpsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) + ctheta*spsi*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*cpsi*ctheta)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))];
F(11,1:12) = [                                                                                                                                                                                    sphi*((clong*(sphi*spsi + cphi*cpsi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) + (cphi*ctheta*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*((clong*(cphi*spsi - cpsi*sphi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (ctheta*slong*sphi)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))),                                                                                                (cphi*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))) + (sphi*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))),                                                                                      0,                    0,            cphi,            -sphi, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           - cphi*((cphi*spsi - cpsi*sphi*stheta)*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) + ctheta*sphi*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (v*slong*(cphi*cpsi + sphi*spsi*stheta))/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*v*slong*(cphi*cpsi + sphi*spsi*stheta))/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2))) - sphi*((sphi*spsi + cphi*cpsi*stheta)*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - cphi*ctheta*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (v*slong*(cpsi*sphi - cphi*spsi*stheta))/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*v*slong*(cpsi*sphi - cphi*spsi*stheta))/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2))),                                                                                                                                                                                                                                                                        - sphi*((u*clong*(sphi*spsi + cphi*cpsi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2) + (u*cphi*ctheta*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2) - cphi*((u*clong*(cphi*spsi - cpsi*sphi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2) - (u*ctheta*slong*sphi)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2),                                                     sphi*((cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - sphi*(q + (cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - cphi*((sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - cphi*(r - (sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      sphi*(cphi*stheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*cpsi*ctheta*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*cphi*ctheta*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) - cphi*(sphi*stheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cpsi*ctheta*sphi*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*ctheta*sphi*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))),                                                                                                                                                                                                              cphi*((cphi*cpsi + sphi*spsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cphi*spsi - cpsi*sphi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))) + sphi*((cpsi*sphi - cphi*spsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(sphi*spsi + cphi*cpsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))))];
F(12,1:12) = [                                                                                                                                                          (sphi*((clong*(cphi*spsi - cpsi*sphi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (ctheta*slong*sphi)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))))/ctheta - (cphi*((clong*(sphi*spsi + cphi*cpsi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) + (cphi*ctheta*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))))/ctheta,                                                                          (sphi*(cphi*cpsi + sphi*spsi*stheta))/(clong*ctheta*(alt + a/(1 - e^2*slong^2)^(1/2))) - (cphi*(cpsi*sphi - cphi*spsi*stheta))/(clong*ctheta*(alt + a/(1 - e^2*slong^2)^(1/2))),                                                                                      0,                    0, sphi/ctheta,  cphi/ctheta, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (cphi*((sphi*spsi + cphi*cpsi*stheta)*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - cphi*ctheta*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (v*slong*(cpsi*sphi - cphi*spsi*stheta))/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*v*slong*(cpsi*sphi - cphi*spsi*stheta))/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2))))/ctheta - (sphi*((cphi*spsi - cpsi*sphi*stheta)*(omega_ie*slong + (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - (3*a*e^2*u*clong^2*slong*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) + ctheta*sphi*((u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2)) - omega_ie*clong + (3*a*e^2*u*clong*slong^2*(e^2 - 1))/((1 - e^2*slong^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2)) - (v*slong*(cphi*cpsi + sphi*spsi*stheta))/(clong^2*(alt + a/(1 - e^2*slong^2)^(1/2))) + (a*e^2*v*slong*(cphi*cpsi + sphi*spsi*stheta))/((alt + a/(1 - e^2*slong^2)^(1/2))^2*(1 - e^2*slong^2)^(3/2))))/ctheta,                                                                                                                                                                                                                                                (cphi*((u*clong*(sphi*spsi + cphi*cpsi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2) + (u*cphi*ctheta*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2))/ctheta - (sphi*((u*clong*(cphi*spsi - cpsi*sphi*stheta))/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2 + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2))^2) - (u*ctheta*slong*sphi)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))^2))/ctheta, (cphi*(q + (cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta - (sphi*(r - (sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta - (cphi*((cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta - (sphi*((sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta,                                                                                                                                                                                                                                                                          (cphi*stheta*(r - (sphi*spsi + cphi*cpsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*ctheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cpsi*sphi - cphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta^2 - (sphi*(sphi*stheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cpsi*ctheta*sphi*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*ctheta*sphi*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta - (cphi*(cphi*stheta*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + cphi*cpsi*ctheta*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*cphi*ctheta*spsi)/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta + (sphi*stheta*(q + (cphi*spsi - cpsi*sphi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + ctheta*sphi*(omega_ie*slong - (u*slong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) + (v*(cphi*cpsi + sphi*spsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta^2,                                                                                                                                                                                    (sphi*((cphi*cpsi + sphi*spsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(cphi*spsi - cpsi*sphi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta - (cphi*((cpsi*sphi - cphi*spsi*stheta)*(omega_ie*clong + (u*clong)/(alt - (a*(e^2 - 1))/(1 - e^2*slong^2)^(3/2))) - (v*(sphi*spsi + cphi*cpsi*stheta))/(clong*(alt + a/(1 - e^2*slong^2)^(1/2)))))/ctheta];
F(13:14,13:14) = [0 states(14);0 0];

PHI = eye(14) + F*timestep + 0.5*F^2*timestep^2;
end

