function PHI = formPHI(states,forces,moments,timestep)

e = 0.0818191910428; % eccentricity
R_0 = 6378137.0; % equatorial radius [meters]
omega_ie = 7.292115e-5; % Earth's rotation rate [rad/s]
m = 1202.7;
Ixx = 4044.7;
Iyy = 1994.9;
Izz = 5639.2;

fb1 = forces(1);
fb2 = forces(2);
fb3 = forces(3);

u = states(1);
v = states(2);
w = states(3);
p = states(4);
q = states(5);
r = states(6);
lat = states(7);
long = states(8);
alt = states(9);
phi = states(10);
theta = states(11);
ps = states(12);

cphi = cos(phi);
sphi = sin(phi);

ctheta = cos(theta);
stheta = sin(theta);
ttheta = tan(theta);

cpsi = cos(ps);
spsi = sin(ps);

slat = sin(lat);
clat = cos(lat);

F = zeros(14,14);

F(1,:) = [                                                                 w/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                             - 2*omega_ie*sin(lat) - (2*v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)),           u/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (3*R_0*e^2*u*w*cos(lat)*sin(lat)*(e^2 - 1))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2)) - v*(2*omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (v^2*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 - (u*w)/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,   (fb2*(sin(conj(phi))*sin(conj(ps)) + cos(conj(phi))*cos(conj(ps))*sin(conj(theta))))/m + (fb3*(cos(conj(phi))*sin(conj(ps)) - cos(conj(ps))*sin(conj(phi))*sin(conj(theta))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (cos(conj(ps))*(fb3*cos(conj(phi))*cos(conj(theta)) - fb1*sin(conj(theta)) + fb2*cos(conj(theta))*sin(conj(phi))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                          (fb3*(cos(conj(ps))*sin(conj(phi)) - cos(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m - (fb2*(cos(conj(phi))*cos(conj(ps)) + sin(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m - (fb1*cos(conj(theta))*sin(conj(ps)))/m, 0, 0];
F(2,:) = [                                            2*omega_ie*sin(lat) + (v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)),                                                  ((w*cos(lat) + u*sin(lat))*(1 - e^2*sin(lat)^2)^(1/2))/(cos(lat)*(R_0 + alt*(1 - e^2*sin(lat)^2)^(1/2))), 2*omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)),                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          u*(2*omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - w*(2*omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   - (v*w)/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 - (u*v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2, - (fb2*(cos(conj(ps))*sin(conj(phi)) - cos(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m - (fb3*(cos(conj(phi))*cos(conj(ps)) + sin(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (sin(conj(ps))*(fb3*cos(conj(phi))*cos(conj(theta)) - fb1*sin(conj(theta)) + fb2*cos(conj(theta))*sin(conj(phi))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                          (fb3*(sin(conj(phi))*sin(conj(ps)) + cos(conj(phi))*cos(conj(ps))*sin(conj(theta))))/m - (fb2*(cos(conj(phi))*sin(conj(ps)) - cos(conj(ps))*sin(conj(phi))*sin(conj(theta))))/m + (fb1*cos(conj(ps))*cos(conj(theta)))/m, 0, 0];
F(3,:) = [                                                            -(2*u)/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                                      - 2*omega_ie*cos(lat) - (2*v)/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)),                                                              0,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 v*(2*omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*R_0*e^2*u^2*cos(lat)*sin(lat)*(e^2 - 1))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2)), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      v^2/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + u^2/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,                                                                                                                   -(cos(conj(theta))*(fb3*sin(conj(phi)) - fb2*cos(conj(phi))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   - (fb1*cos(conj(theta)))/m - (fb3*cos(conj(phi))*sin(conj(theta)))/m - (fb2*sin(conj(phi))*sin(conj(theta)))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(4,:) = [                                                                                                                    0,                                                                                                                                                         0,                                                              0,                    0, (r*(Iyy - Izz))/Ixx,  (q*(Iyy - Izz))/Ixx,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(5,:) = [                                                                                                                    0,                                                                                                                                                         0,                                                              0, -(r*(Ixx - Izz))/Iyy,                   0, -(p*(Ixx - Izz))/Iyy,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(6,:) = [                                                                                                                    0,                                                                                                                                                         0,                                                              0,  (q*(Ixx - Iyy))/Izz, (p*(Ixx - Iyy))/Izz,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(7,:) = [                                                                 1/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                                                                                                         0,                                                              0,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2)), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      -u/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(8,:) = [                                                                                                                    0,                                                                                                       1/(cos(lat)*(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))),                                                              0,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 (v*sin(lat))/(cos(lat)^2*(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (R_0*e^2*v*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2)), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -v/(cos(lat)*(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2),                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(9,:) = [                                                                                                                    0,                                                                                                                                                         0,                                                             -1,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0, 0, 0];
F(10,:) = [       (sin(ps)*(e^2*cos(lat)^2 - e^2 + 1)^(3/2))/(cos(theta)*(R_0 - R_0*e^2 + alt*(e^2*cos(lat)^2 - e^2 + 1)^(3/2))),                                                     -(cos(ps)*(e^2*cos(lat)^2 - e^2 + 1)^(1/2))/(cos(theta)*(R_0 + alt*(e^2*cos(lat)^2 - e^2 + 1)^(1/2))),                                                              0,                    1, sin(phi)*tan(theta),  cos(phi)*tan(theta), cos(phi)*tan(theta)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*cos(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2))) - sin(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + sin(phi)*tan(theta)*(cos(theta)*sin(phi)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2))) + cos(ps)*cos(theta)*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*R_0*e^2*u*cos(lat)*cos(theta)*sin(lat)*sin(ps)*(e^2 - 1))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2)), 0, cos(phi)*tan(theta)*((v*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 - (v*cos(phi)*cos(theta)*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2) - sin(phi)*tan(theta)*((v*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 + (v*cos(theta)*tan(lat)*sin(phi))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2) + (v*cos(ps)*cos(theta))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (v*tan(lat)*sin(theta))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 - (u*cos(theta)*sin(ps))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,                                                                                                                                 (sin(theta)*(q*cos(phi) - r*sin(phi)))/cos(theta), cos(phi)*(tan(theta)^2 + 1)*(r - (sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)))) - cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - cos(phi)*tan(theta)*(cos(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) + cos(phi)*cos(ps)*cos(theta)*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(phi)*cos(theta)*sin(ps))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + sin(phi)*(tan(theta)^2 + 1)*(q + (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)))) - sin(phi)*tan(theta)*(sin(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) + cos(ps)*cos(theta)*sin(phi)*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(theta)*sin(phi)*sin(ps))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + cos(ps)*sin(theta)*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*sin(ps)*sin(theta))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)), sin(phi)*tan(theta)*((cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) - cos(phi)*tan(theta)*((cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + cos(theta)*sin(ps)*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) + (u*cos(ps)*cos(theta))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)), 0, 0];
F(11,:) = [(2^(1/2)*cos(ps)*(e^2*cos(2*lat) - e^2 + 2)^(3/2))/(4*R_0 - 4*R_0*e^2 + 2^(1/2)*alt*(e^2*cos(2*lat) - e^2 + 2)^(3/2)),                                                                               (sin(ps)*(1 - e^2*sin(lat)^2)^(1/2))/(R_0 + alt*(1 - e^2*sin(lat)^2)^(1/2)),                                                              0,                    0,            cos(phi),            -sin(phi),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     cos(phi)*(cos(theta)*sin(phi)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2))) - sin(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*cos(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2))), 0,                                                                                                                                                                                                                                        - cos(phi)*((v*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 + (v*cos(theta)*tan(lat)*sin(phi))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2) - sin(phi)*((v*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 - (v*cos(phi)*cos(theta)*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2),                                                                                                                                                         - r*cos(phi) - q*sin(phi),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                       cos(phi)*((cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + sin(phi)*((cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))), 0, 0];
F(12,:) = [        (sin(ps)*sin(theta)*(1 - e^2*sin(lat)^2)^(3/2))/(cos(theta)*(R_0 - R_0*e^2 + alt*(1 - e^2*sin(lat)^2)^(3/2))), ((cos(theta)*sin(lat) - cos(lat)*cos(ps)*sin(theta))*(e^2*cos(lat)^2 - e^2 + 1)^(1/2))/(cos(lat)*cos(theta)*(R_0 + alt*(e^2*cos(lat)^2 - e^2 + 1)^(1/2))),                                                              0,                    0, sin(phi)/cos(theta),  cos(phi)/cos(theta),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (cos(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*cos(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2))))/cos(theta) + (sin(phi)*(cos(theta)*sin(phi)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2)) - (R_0*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*sin(lat) + (R_0*e^2*v*cos(lat)*sin(lat))/((alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*R_0*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/((alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2*(1 - e^2*sin(lat)^2)^(5/2))))/cos(theta), 0,                                                                                                                                                                                                                (cos(phi)*((v*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 - (v*cos(phi)*cos(theta)*tan(lat))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2))/cos(theta) - (sin(phi)*((v*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 + (v*cos(theta)*tan(lat)*sin(phi))/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))^2))/cos(theta),                                                                                                                                              (q*cos(phi) - r*sin(phi))/cos(theta),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (u*sin(ps)*(1 - e^2*sin(lat)^2)^(3/2))/(R_0 - R_0*e^2 + alt*(1 - e^2*sin(lat)^2)^(3/2)) - (q*sin(phi)*sin(theta))/(sin(theta)^2 - 1) - omega_ie*cos(lat)*cos(phi)^2*cos(ps) - omega_ie*cos(lat)*cos(ps)*sin(phi)^2 + (r*cos(phi)*sin(theta))/cos(theta)^2 - (v*cos(ps)*sin(phi)^2*(1 - e^2*sin(lat)^2)^(1/2))/(R_0 + alt*(1 - e^2*sin(lat)^2)^(1/2)) - (v*cos(phi)^2*cos(ps)*(1 - e^2*sin(lat)^2)^(1/2))/(R_0 + alt*(1 - e^2*sin(lat)^2)^(1/2)) - (omega_ie*cos(lat)*cos(phi)^2*cos(ps)*sin(theta)^2)/cos(theta)^2 - (omega_ie*cos(lat)*cos(ps)*sin(phi)^2*sin(theta)^2)/cos(theta)^2 + (u*sin(phi)^2*sin(ps)*sin(theta)^2*(1 - e^2*sin(lat)^2)^(3/2))/(cos(theta)^2*(R_0 - R_0*e^2 + alt*(1 - e^2*sin(lat)^2)^(3/2))) - (v*cos(phi)^2*cos(ps)*sin(theta)^2*(1 - e^2*sin(lat)^2)^(1/2))/(cos(theta)^2*(R_0 + alt*(1 - e^2*sin(lat)^2)^(1/2))) - (v*cos(ps)*sin(phi)^2*sin(theta)^2*(1 - e^2*sin(lat)^2)^(1/2))/(cos(theta)^2*(R_0 + alt*(1 - e^2*sin(lat)^2)^(1/2))) + (u*cos(phi)^2*sin(ps)*sin(theta)^2*(1 - e^2*sin(lat)^2)^(3/2))/(cos(theta)^2*(R_0 - R_0*e^2 + alt*(1 - e^2*sin(lat)^2)^(3/2))),                                                                                                                                                             (sin(phi)*((cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))))/cos(theta) - (cos(phi)*((cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + R_0/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt - (R_0*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))))/cos(theta), 0, 0];
F(13,14) = states(14);

PHI = expm(F*timestep);
end

