function PHI = formPHI(states,forces,moments,timestep)

e = 0.0818191910428; % eccentricity
a = 6378137.0; % equatorial radius [meters]
omega_ie = 7.292115e-5; % Earth's rotation rate [rad/s]
m = 1202.7;
Ixx = 4044.7;
Iyy = 1994.9;
Izz = 5639.2;

fb1 = forces(1);
fb2 = forces(2);
fb3 = forces(3);

u = states(1);
v = states(2);
w = states(3);
p = states(4);
q = states(5);
r = states(6);
lat = states(7);
long = states(8);
alt = states(9);
phi = states(10);
theta = states(11);
ps = states(12);

cphi = cos(phi);
sphi = sin(phi);

ctheta = cos(theta);
stheta = sin(theta);
ttheta = tan(theta);

cpsi = cos(ps);
spsi = sin(ps);

slat = sin(lat);
clat = cos(lat);

F = zeros(14,14);

F(1,1:12) = [                                                                                                                                                                                                                                                                       w/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                                                                                                                                                                                                                                                                                                                                                                    - 2*omega_ie*sin(lat) - (2*v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)),           u/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (3*a*e^2*u*w*cos(lat)*sin(lat)*(e^2 - 1))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2) - v*(2*omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (v^2*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 - (u*w)/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (fb2*(sin(conj(phi))*sin(conj(ps)) + cos(conj(phi))*cos(conj(ps))*sin(conj(theta))))/m + (fb3*(cos(conj(phi))*sin(conj(ps)) - cos(conj(ps))*sin(conj(phi))*sin(conj(theta))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (fb3*cos(conj(phi))*cos(conj(ps))*cos(conj(theta)))/m - (fb1*cos(conj(ps))*sin(conj(theta)))/m + (fb2*cos(conj(ps))*cos(conj(theta))*sin(conj(phi)))/m,                                                                                                                                                                                                                                                                                                                                                                                                                              (fb3*(cos(conj(ps))*sin(conj(phi)) - cos(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m - (fb2*(cos(conj(phi))*cos(conj(ps)) + sin(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m - (fb1*cos(conj(theta))*sin(conj(ps)))/m];
F(2,1:12) = [                                                                                                                                                                                                                                                  2*omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)),                                                                                                                                                                                                                                                                                                                                                                                                     w/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) + (u*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)), 2*omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)),                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          u*(2*omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - w*(2*omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     - (v*w)/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 - (u*v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             - (fb2*(cos(conj(ps))*sin(conj(phi)) - cos(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m - (fb3*(cos(conj(phi))*cos(conj(ps)) + sin(conj(phi))*sin(conj(ps))*sin(conj(theta))))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (fb3*cos(conj(phi))*cos(conj(theta))*sin(conj(ps)))/m - (fb1*sin(conj(ps))*sin(conj(theta)))/m + (fb2*cos(conj(theta))*sin(conj(phi))*sin(conj(ps)))/m,                                                                                                                                                                                                                                                                                                                                                                                                                              (fb3*(sin(conj(phi))*sin(conj(ps)) + cos(conj(phi))*cos(conj(ps))*sin(conj(theta))))/m - (fb2*(cos(conj(phi))*sin(conj(ps)) - cos(conj(ps))*sin(conj(phi))*sin(conj(theta))))/m + (fb1*cos(conj(ps))*cos(conj(theta)))/m];
F(3,1:12) = [                                                                                                                                                                                                                                                                  -(2*u)/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                                                                                                                                                                                                                                                                                                                                                                             - 2*omega_ie*cos(lat) - (2*v)/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)),                                                            0,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               v*(2*omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*a*e^2*u^2*cos(lat)*sin(lat)*(e^2 - 1))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        v^2/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + u^2/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (fb2*cos(conj(phi))*cos(conj(theta)))/m - (fb3*cos(conj(theta))*sin(conj(phi)))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     - (fb1*cos(conj(theta)))/m - (fb3*cos(conj(phi))*sin(conj(theta)))/m - (fb2*sin(conj(phi))*sin(conj(theta)))/m,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(4,1:12) = [                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                            0,                    0, (Iyy*r - Izz*r)/Ixx,  (Iyy*q - Izz*q)/Ixx,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(5,1:12) = [                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                            0, -(Ixx*r - Izz*r)/Iyy,                   0, -(Ixx*p - Izz*p)/Iyy,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(6,1:12) = [                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                            0,  (Ixx*q - Iyy*q)/Izz, (Ixx*p - Iyy*p)/Izz,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(7,1:12) = [                                                                                                                                                                                                                                                                       1/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                            0,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      -u/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(8,1:12) = [                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                              1/(cos(lat)*(alt + a/(1 - e^2*sin(lat)^2)^(1/2))),                                                            0,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (v*sin(lat))/(cos(lat)^2*(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (a*e^2*v*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2)), 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -v/(cos(lat)*(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(9,1:12) = [                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                           -1,                    0,                   0,                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0];
F(10,1:12) =[(cos(theta)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) - (cos(phi)*tan(theta)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + (sin(phi)*tan(theta)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)), sin(phi)*tan(theta)*((cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) + (cos(theta)*tan(lat)*sin(phi))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (tan(lat)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - cos(phi)*tan(theta)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (cos(phi)*cos(theta)*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (cos(ps)*cos(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)),                                                            0,                    1, sin(phi)*tan(theta),  cos(phi)*tan(theta), sin(phi)*tan(theta)*(cos(theta)*sin(phi)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2)) - sin(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(ps)*cos(theta)*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*tan(theta)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*cos(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2)) + (3*a*e^2*u*cos(lat)*cos(theta)*sin(lat)*sin(ps)*(e^2 - 1))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2), 0, cos(phi)*tan(theta)*((v*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 - (v*cos(phi)*cos(theta)*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2) - sin(phi)*tan(theta)*((v*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 + (v*cos(theta)*tan(lat)*sin(phi))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2) + (v*cos(ps)*cos(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (v*tan(lat)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 - (u*cos(theta)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2,         cos(phi)*tan(theta)*(q + (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - sin(phi)*tan(theta)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) - cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - cos(phi)*tan(theta)*((cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - sin(phi)*tan(theta)*(r - (sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))), cos(phi)*(tan(theta)^2 + 1)*(r - (sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - cos(phi)*tan(theta)*(cos(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + cos(phi)*cos(ps)*cos(theta)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(phi)*cos(theta)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + sin(phi)*(tan(theta)^2 + 1)*(q + (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - sin(phi)*tan(theta)*(sin(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + cos(ps)*cos(theta)*sin(phi)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(theta)*sin(phi)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + cos(ps)*sin(theta)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*sin(ps)*sin(theta))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)), sin(phi)*tan(theta)*((cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) - cos(phi)*tan(theta)*((cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + cos(theta)*sin(ps)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*cos(ps)*cos(theta))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))];
F(11,1:12) =[                                                                                              (cos(phi)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + (sin(phi)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)),                                                                                                                                                cos(phi)*((cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) + (cos(theta)*tan(lat)*sin(phi))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + sin(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (cos(phi)*cos(theta)*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))),                                                            0,                    0,            cos(phi),            -sin(phi),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       cos(phi)*(cos(theta)*sin(phi)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2)) - sin(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*cos(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2)), 0,                                                                                                                                                                                                                                  - cos(phi)*((v*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 + (v*cos(theta)*tan(lat)*sin(phi))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2) - sin(phi)*((v*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 - (v*cos(phi)*cos(theta)*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2),                                                     sin(phi)*((cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - cos(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) - cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - sin(phi)*(q + (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))) - cos(phi)*(r - (sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        sin(phi)*(cos(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + cos(phi)*cos(ps)*cos(theta)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(phi)*cos(theta)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) - cos(phi)*(sin(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + cos(ps)*cos(theta)*sin(phi)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(theta)*sin(phi)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))),                                                                                                                                                                                   cos(phi)*((cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) + sin(phi)*((cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)))];
F(12,1:12) =[                                                                    (sin(phi)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(cos(theta)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(cos(theta)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))),                                                                                                                      (sin(phi)*((cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) + (cos(theta)*tan(lat)*sin(phi))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))))/cos(theta) - (cos(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (cos(phi)*cos(theta)*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))))/cos(theta),                                                            0,                    0, sin(phi)/cos(theta),  cos(phi)/cos(theta),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (cos(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + cos(phi)*cos(theta)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2)))/cos(theta) + (sin(phi)*(cos(theta)*sin(phi)*(omega_ie*cos(lat) + (v*(tan(lat)^2 + 1))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)) - (a*e^2*v*cos(lat)*sin(lat)*tan(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) - (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*sin(lat) + (a*e^2*v*cos(lat)*sin(lat))/((alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2*(1 - e^2*sin(lat)^2)^(3/2))) + (3*a*e^2*u*cos(lat)*sin(lat)*(e^2 - 1)*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/((1 - e^2*sin(lat)^2)^(5/2)*(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2)))/cos(theta), 0,                                                                                                                                                                                                          (cos(phi)*((v*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 - (v*cos(phi)*cos(theta)*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2))/cos(theta) - (sin(phi)*((v*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2 + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))^2 + (v*cos(theta)*tan(lat)*sin(phi))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))^2))/cos(theta), (cos(phi)*(q + (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))))/cos(theta) - (sin(phi)*(r - (sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))))/cos(theta) - (cos(phi)*((cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))))/cos(theta) - (sin(phi)*((sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) - cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))))/cos(theta),                                                                                                                                                                                                                                (cos(phi)*sin(theta)*(r - (sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(phi)*cos(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))))/cos(theta)^2 - (cos(phi)*(cos(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + cos(phi)*cos(ps)*cos(theta)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(phi)*cos(theta)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))))/cos(theta) - (sin(phi)*(sin(phi)*sin(theta)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + cos(ps)*cos(theta)*sin(phi)*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*cos(theta)*sin(phi)*sin(ps))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))))/cos(theta) + (sin(phi)*sin(theta)*(q + (cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) + (u*(cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2)) + cos(theta)*sin(phi)*(omega_ie*sin(lat) + (v*tan(lat))/(alt + a/(1 - e^2*sin(lat)^2)^(1/2)))))/cos(theta)^2,                                                                                                                                                         (sin(phi)*((cos(phi)*cos(ps) + sin(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(cos(phi)*sin(ps) - cos(ps)*sin(phi)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))))/cos(theta) - (cos(phi)*((cos(ps)*sin(phi) - cos(phi)*sin(ps)*sin(theta))*(omega_ie*cos(lat) + v/(alt + a/(1 - e^2*sin(lat)^2)^(1/2))) - (u*(sin(phi)*sin(ps) + cos(phi)*cos(ps)*sin(theta)))/(alt - (a*(e^2 - 1))/(1 - e^2*sin(lat)^2)^(3/2))))/cos(theta)];
 

PHI = expm(F*timestep);
end

